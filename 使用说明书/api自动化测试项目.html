<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="1074321997@qq.com"/><meta name="created" content="2017-02-28 02:50:40 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-02-28 06:34:49 +0000"/><title>api自动化测试项目</title></head><body><div>项目功能：自动化测试nut app接口</div><div>项目所用：python,wxpython</div><div>项目路径：<font style="font-family: Menlo; font-size: 11px;">nut-qa-doc/nutapp/api_test_WQRF</font></div><div>启动方法：运行Begin.py</div><div><br/></div><div>项目分为三层：用例准备；执行用例；生产报告</div><div>具体文件关系如下图：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/C3FE365F-B1EE-49C5-BAA9-5763664EDD63.png" height="1748" width="2212"/><br/></div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/A10B2BC3-9A04-4D54-8468-5A8F14596A5E.png" height="566" width="490"/><br/></div><div><br/></div><div>如下图所示：接口测试主要分为 单接口内部参数测试 和 多接口间逻辑测试：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/5D506FF7-D740-4C93-AEAB-3031B92E5F00.png" height="68" width="412"/><br/></div><div>面对接口内参数变更的情况，只修改api_doc/make.py文件中的对应接口内参数结构即可影响所有用例：<br/></div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/DEB4D558-4875-4AC6-9E7D-C1C134E579D4.png" height="238" width="814"/><br/></div><div><br/></div><div>单接口测试 是自动生成用例，每个参数的测试准备数据写在了single_case/testSuit.py里：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/2EF30373-C97C-4A79-8A88-0095A9A74D63.png" height="86" width="1768"/><br/></div><div><br/></div><div>单接口测试用例执行结果显示：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/CC4B2D54-9C39-48E2-B761-F59E2F86A654.png" height="706" width="2776"/><br/></div><div><br/></div><div>单接口测试测试报告是excel表：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/51B55E95-FFAA-4224-A033-582F15247947.png" height="1004" width="1630"/><br/></div><div><br/></div><div>单接口测试报告中默认 返回值ret：500时会标红。可以在single_case/case_old.py中自行设置：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/71A16BA4-C76F-4213-9026-7131D1660D3F.png" height="58" width="948"/><br/></div><div><br/></div><div>单接口测试具体测试接口需要在single_case/case_old.py中取消对应接口的注释，每个接口是一个列表，内部分为3部分：接口在make.py中对应的方法名；正确的参数（无视结构）；token。不传的话也要用’’来占位。</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/11CEAFFA-ECB8-4791-8371-E6FC333D75A5.png" height="196" width="916"/><br/></div><div><br/></div><div>多接口逻辑测试模块中，分为initialize:初始化模块 ； test_gps/test_new/test_gps:测试服用例 ； test_online:正式服用例 ；assert_response:深层判断算法 </div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/FDD335A3-BB06-48C2-97FD-66ACAFBAEA95.png" height="420" width="514"/><br/></div><div><br/></div><div>其中 各用例中以ABC等大写字母来代表模块。每个模块内从test_01开始排序成为测试用例。执行时默认从01开始执行。</div><div>每个模块内的类方法中会调用初始化模块。</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/A2A839A2-B09E-4084-B969-2910DF5F34F1.png" height="914" width="642"/><br/></div><div><br/></div><div>具体用例执行控制在文件末尾：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/3E711D7A-9F4E-4257-8F4B-0A37C3D0A92D.png" height="64" width="1106"/><br/></div><div><br/></div><div>初始化模块中 包括 清空 账户下所有 好友，贴片，gps，安全区域等功能。调用时只需要传入token即可：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/F3E789E1-C178-4FC6-A840-2B9420AC349D.png" height="622" width="1066"/><br/></div><div><br/></div><div>用例执行时可以自动对比预期结果并进行详细显示，也可以设定为此次运行把结果保存成预期，方便之后测试时进行自动对比。具体操作方法之后介绍。</div><div><br/></div><div>多用例执行时可以显示运行情况，如下图所示，.为通过，F为失败，E为报错：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/B632533D-F149-49FF-B92C-E27E6ED30C6F.png" height="576" width="810"/><br/></div><div><br/></div><div>多用例逻辑测试报告：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/592B6370-F147-49D1-A87D-1B594DFBF29F.png" height="1292" width="1802"/><br/></div><div><br/></div><div>深层判断算法会显示和预期的详细具体某个参数的不一致情况：仅内容不同会黑矩形，格式不同或找不到参数会xxxxx</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/0FECE7CF-7A61-4D6A-8AD2-31E2083DD549.png" height="740" width="2386"/><br/></div><div><br/></div><div>推送测试，推送测试目前的方法就是自动去后台查询最近的10条推送，并通过类型，设备token等来过滤。最终判定是否查到了推送和推送的内容。文件在sqlORpush/push_01.py中；</div><div>数据库检测，通过对数据库进行查询操作来测试。文件在sqlORpush/sql_01.py中</div><div><br/></div><div>edit.py 中主要功能用：</div><div>1.控制所有接口超时时间：</div><div><pre style="background-color:#141414;color:#f8f8f8;font-family:'Menlo';font-size:9.0pt;"><span style="background-color:#472c47;">timout</span> <span style="color:#cda869;">= </span><span style="color:#cf6a4c;">5 </span><span style="color:#5f5a60;font-style:italic;">#单位:秒   不可低于0.02秒。测试尽量不要太小。判定超时后将立即中断此次请求。所以就看不到真正的所用时间了</span>
</pre></div><div>2.设置token在header中的信息：</div><div><pre style="background-color:#141414;color:#f8f8f8;font-family:'Menlo';font-size:9.0pt;"><span style="background-color:#472c47;">head_demo</span> <span style="color:#cda869;">= </span><span style="color:#8f9d6a;">'Authorization'   </span><span style="color:#5f5a60;font-style:italic;">#设置token的NAME</span>
</pre>3.设置代理，默认内测服，http和https。注释掉就是不用代理：</div><div><pre style="background-color:#141414;color:#f8f8f8;font-family:'Menlo';font-size:9.0pt;"><span style="color:#5f5a60;font-style:italic;"># daili = {'https':'192.168.0.200:8118','http':'192.168.0.200:8118'}   #设置代理模式,注释则为不挂代理</span></pre><br/></div><div>Email.py中主要就是发送邮件，多接口逻辑测试用例默认执行完都会发送邮件。</div><div>可以注视掉邮件中的发送语句来不发送邮件：</div><div><pre style="background-color:#141414;color:#f8f8f8;font-family:'Menlo';font-size:9.0pt;"><span style="color:#5f5a60;font-style:italic;"># smtp.sendmail(msgfrom, msgto, msg.as_string())  # 发送</span></pre></div><div>设置收件人：</div><div><pre style="background-color:#141414;color:#f8f8f8;font-family:'Menlo';font-size:9.0pt;">msgto <span style="color:#cda869;">= </span>[<span style="color:#8f9d6a;">'wangzijia@nutspace.com'</span>]  <span style="color:#5f5a60;font-style:italic;"># 收件人地址 多个联系人，格式['aa@163.com', 'bb@163.com']</span>
</pre><br/></div><div>req.py和req_log.py 是负责发送请求并处理返回值的模块，前者对应单接口测试用例，没有详细的请求log。后者对应多接口逻辑测试用例，有详细log，会显示在测试报告中，包含4种请求和表单上传方式。调用时 可以传token,国家代号等。</div><div><br/></div><div>switch.txt为配置文件。主要控制每次执行用例时，是提取预期 还是 写入预期。</div><div><br/></div><div>token_get.py 文件主要提供了 邮件和手机 两种登陆方式 ，调用需要传入账号名，默认密码是’qwerty’，返回token</div><div><br/></div><div>WQRFhtmlRunner.py 功能是生存html的测试报告。</div><div><br/></div><div>启动方式：</div><div>运行begin.py后会出现主界面：</div><div><img src="api%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE.resources/3AD416D6-970F-4651-BBF4-B51FD210F71C.png" height="520" width="680"/><br/></div><div>注意每次要确保host正确，在运行用例。</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>